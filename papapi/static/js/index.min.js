var db,dbVersion=1;function close(){sessionStorage.setItem("step",2),$("body").css("opacity","0"),setTimeout(function(){window.location.href="/second_step"},500)}function initDb(){var e=indexedDB.open("diplomas",dbVersion);e.onerror=function(e){console.error("Unable to open database.")},e.onsuccess=function(e){db=e.target.result,console.log("db opened")},e.onupgradeneeded=function(e){(db=e.target.result).createObjectStore("image",{keyPath:"timestamp"})}}function saveImage(e){var t=e.target.files[0],n=new FileReader;n.readAsBinaryString(t),n.onload=function(e){var t=e.target.result,n={timestamp:Date.now(),data:t},o=db.transaction(["image"],"readwrite").objectStore("image"),r=o.count();r.onsuccess=()=>{var e=r.result;o.openCursor(null).onsuccess=function(t){var n=t.target.result;n&&e>=5&&(o.delete(n.key),e-=1,n.continue())};var t=o.add(n);t.onerror=e=>{console.log("Error storing data"),console.error(e)},t.onsuccess=function(e){console.log("Added image to IndexedDB"),close()}}}}document.addEventListener("DOMContentLoaded",()=>{initDb(),document.querySelector("#picture").addEventListener("change",saveImage),$("body").css("opacity","1")});